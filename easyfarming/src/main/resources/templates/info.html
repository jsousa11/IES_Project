<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Easy Farming</title>
    <link href= "css/style.css" rel="stylesheet"/>
    <link href='https://fonts.googleapis.com/css?family=ABeeZee' rel='stylesheet'>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500&display=swap" rel="stylesheet">
    <script src= "js/date.js" defer> </script>
    <meta nome="viewport" content=" witdth= device-width, initial-scale=1.0, maximum-scale=1.0">
</head>
<body>
<header>
    <div class = "center">
        <div class="logo"><img src="assets/Logotipo planta com folhas.png" height="150" width="150"></div><!--logo-->
        <div class="menu">
            <a href="/login.html" th:href="@{/login}">Logout</a>
        </div><!--menu-->
    </div><!--center-->
</header>

<!--<section class="sobre">
    <div class="center">
        <div class="texto-sobre">
            <h1>Hi<br/> <span style="color:#83bf21 ;">@User</span></h1>
            <p>Welcome to a new day of garden adventures!</p>
        </div>
        <div class="datetime">
            <div class="time"></div>
            <div class="date"></div>
        </div>
    </div>
</section>-->
<div class="welcome">
    <h1> Hi, <span style="color:#83bf21">@Ana Moreira</span></h1>
</div>
    <div class="datetime-box">
        <div class="datetime">
            <div class="time"></div>
            <div class="date"></div>
        </div>
    </div>
    <div class="user-boxes">
        <h2>Increase the garden...</h2>
        <form>
            <input type="file" multiple />
            <button type="button">OK</button>
        </form>
    </div>
    <div class="info-tasks">
        <ul id="resultados"></ul>
        <script type="text/javascript">
          
            document.querySelector('button').onclick = function sendIdentification() {
                const files = [...document.querySelector('input[type=file]').files];
                const promises = files.map((file) => {
                  return new Promise((resolve, reject) => {
                      const reader = new FileReader();
                      reader.onload = (event) => {
                        const res = event.target.result;
                        console.log(res);
                        resolve(res);
                      }
                      reader.readAsDataURL(file)
                  })
                })
                
                Promise.all(promises).then((base64files) => {
                  console.log(base64files)
                        
                  const data = {
                    api_key: "p9zvCLwZ1BWIfO9DYgszYYB1H1YKPKm9ygbQ3KSdbosSWn16FT",
                    images: base64files,
                    // modifiers docs: https://github.com/flowerchecker/Plant-id-API/wiki/Modifiers
                    modifiers: ["crops_fast", "similar_images"],
                    plant_language: "en",
                    // plant details docs: https://github.com/flowerchecker/Plant-id-API/wiki/Plant-details
                    plant_details: ["common_names",
                                    "url",
                                    "name_authority",
                                    "wiki_description",
                                    "taxonomy",
                                    "synonyms"],
                  };
                  
                  fetch('https://api.plant.id/v2/identify', {
                    method: 'POST',
                    headers: {
                      'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data),
                  })
                  .then(response => response.json())
                  .then(data => {
                    console.log('Success:', data);
                    res = document.getElementById("resultados");
                    for (let i = 0; i < data["suggestions"].length; i++) {
                        child = document.createElement("li");
                        child.innerHTML = `<a class="a-results" href="info/${data["suggestions"][i]["plant_name"].toLowerCase()}">${data["suggestions"][i]["plant_name"]}</a>`;
                        res.appendChild(child);
                    }
                    })
                  .catch((error) => {
                    console.error('Error:', error);
                  });
                })
              
            };
            
        </script>
    </div>
</body>
</html>